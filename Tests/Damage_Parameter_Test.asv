

addpath(genpath('..\Functions\'))
addpath(genpath('..\Simulation_Data\'))
addpath(fileparts(pwd));

config = Config();

config.normalise_plot = 1;

plotting_variables = [];

location = "Lancaster";

use_best = false;

config.Set_Location(location);

config.use_best_distribution_simulation = false;

test_result_damages = Main_Algorithm(config);

config.use_best_distribution_simulation = use_best;

test_result_air_drops = Main_Algorithm(config);

damage_time_series = sum(test_result_damages.damage_matrix,2);

n_droplets_air = test_result_air_drops.n_droplets_air;

rainfalls = Rainfall_From_Cubic_Meter(n_droplets_air,test_result_damages.d_calc) * 6; % Convert from the DT of 10 minutes to per hour 

dmasses = Calculate_Dmass(n_droplets_air,test_result_damages.d_calc,test_result_damages.d_bins);
dmasses(isnan(dmasses)) = 0;

damage_time_series = damage_time_series / sum(damage_time_series);

loglog(rainfalls,damage_time_series,'x','MarkerSize',3)

xlabel('$Rainfall [mm/h]$', 'Interpreter', 'latex','FontSize', 16)
ylabel('$D_s$', 'Interpreter', 'latex','FontSize', 16)
ylim([1e-9 1e-2])
xlim([1e-4 100])